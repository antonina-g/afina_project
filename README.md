

Athena – персональные учебные стратегии с LLM

Athena — это веб‑приложение на Django, которое помогает пользователям формировать персональные стратегии обучения по выбранным курсам, используя локально развёрнутую LLM (через Ollama). Приложение собирает ответы пользователя на этапе онбординга, формирует профиль и генерирует стратегию прохождения курсов.

 Основные возможности

- Онбординг с вопросами о целях и предпочтениях обучения.  
- Формирование профиля пользователя и подбор топ‑курсов.  
- Генерация учебной стратегии для каждого курса с помощью LLM (Ollama + локальная модель).  
- Панель администратора Django для управления данными.  
- Docker‑окружение для быстрого запуска (Gunicorn, Django, Ollama).

 Технологии

- Backend: Django, Django REST Framework  
- HTTP‑сервер: Gunicorn  
- Контейнеризация: Docker, docker‑compose  
- LLM: Ollama (по умолчанию модель `qwen2.5:3b` или другая, указанная в настройках)  
- База данных: (укажи: PostgreSQL / SQLite / др.)  



Запуск в Docker

 1. Предварительные требования

- Docker и docker‑compose установлен(ы)  
- На хостовой машине установлен и настроен Ollama  
- Модель для генерации стратегий загружена, например:

```bash
ollama pull qwen2.5:3b
```

Запусти Ollama:

```bash
ollama serve
```

 2. Настройки окружения

Скопируй пример `.env` (если есть) или создай `.env` вручную. Укажи базовые переменные окружения:  

- `DJANGO_SECRET_KEY`  
- параметры базы данных (если используется PostgreSQL и т.п.)  
- `DEBUG` (по умолчанию `True` для разработки)

В `settings.py` должно быть указано URL Ollama (в Docker‑режиме, когда Django крутится в контейнере, а Ollama — на хосте):

- Windows / macOS:

```python
OLLAMA_URL = "http://host.docker.internal:11434"
```

- Linux (пример, может отличаться):

```python
OLLAMA_URL = "http://172.17.0.1:11434"
```

Убедись, что это значение совпадает с тем, что реально доступно из контейнера.

 3. Сборка и запуск

Из корня проекта:

```bash
docker-compose up -d --build
```

Сервис `web` стартует Django под Gunicorn, БД будет развёрнута соответствующим сервисом (если описана в `docker-compose.yml`).

Выполни миграции (если не автоматизировано):

```bash
docker-compose exec web python manage.py migrate
```

Создай суперпользователя:

```bash
docker-compose exec web python manage.py createsuperuser
```

Приложение будет доступно по адресу:

```text
http://127.0.0.1:8000/
```

Панель администратора Django:

```text
http://127.0.0.1:8000/admin/
```
 Локальный запуск без Docker

Для разработки можно запускать Django напрямую.

1. Требования

- Python 3.11+  
- Виртуальное окружение (рекомендуется)  
- Установленные зависимости:

```bash
pip install -r requirements.txt
```

 2. Настройка Ollama

Если Django и Ollama работают на одной машине без Docker, в `settings.py`:

```python
OLLAMA_URL = "http://127.0.0.1:11434"
```

Убедись, что Ollama запущена и модель доступна:

```bash
ollama serve
ollama list
```

 3. Миграции и запуск

```bash
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```

По умолчанию сервер будет доступен по адресу:

```text
http://127.0.0.1:8000/
```


 Интеграция с LLM (Ollama)

Функция `call_llm_for_strategy` формирует промпт из данных профиля и информации о курсе и вызывает Ollama через HTTP API (эндпоинт `/api/generate`). Если запрос к Ollama завершается с ошибкой или по таймауту, используется запасная стратегия (stub), чтобы онбординг не падал.

Рекомендуется:

- выставить разумный таймаут в `requests.post(..., timeout=120)` при вызове Ollama;
- выставить таймаут Gunicorn, превышающий таймаут внешнего запроса, например `--timeout 180`.

 Типичный флоу онбординга

1. Пользователь проходит анкету онбординга.  
2. Бэкенд создаёт профиль пользователя и определяет топ‑курсы.  
3. Для каждого курса вызывается LLM, которая генерирует персональную стратегию.  
4. Если LLM недоступна или отвечает слишком долго, для курса используется заглушка стратегии.

 Полезные команды (Docker)

- Остановить контейнеры:

```bash
docker-compose down
```

- Перезапустить только веб‑контейнер:

```bash
docker-compose restart web
```

- Зайти внутрь контейнера:

```bash
docker-compose exec web bash
```



